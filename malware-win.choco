New-Item -Path C:\ -Name Temp -ItemType Directory -ErrorAction SilentlyContinue
New-Item -Path C:\ -Name Payloads -ItemType Directory -ErrorAction SilentlyContinue

$env:TEMP = "C:\Temp"
$env:TMP = "C:\Temp"


# Defender
###############################################################################

$Downloads = Get-ItemPropertyValue 'HKCU:\software\microsoft\windows\currentversion\explorer\shell folders\' -Name '{374DE290-123F-4565-9164-39C4925E467B}'
Add-MpPreference -ExclusionPath $Downloads
Add-MpPreference -ExclusionPath "C:\payloads\"
Add-MpPreference -ExclusionPath "C:\tools\"
Add-MpPreference -ExclusionPath "C:\tools\"
Set-MpPreference -MAPSReporting Disabled
Set-MpPreference -SubmitSamplesConsent NeverSend

# Packages
###############################################################################

choco feature enable -n allowGlobalConfirmation
choco install 7zip
choco install git
choco install firefox
choco install vscode
choco install microsoft-windows-terminal --pre 

# String Analisys Tools
###############################################################################
choco install exiftool
choco install hxd
choco install free-hex-editor-neo

#https://ericzimmerman.github.io/#!index.md
#b2b-download.mcafee.com/products/tools/foundstone/bintext303.zip
#https://www.fireeye.com/blog/threat-research/2019/09/open-sourcing-stringsifter.html
#https://github.com/fireeye/stringsifter/blob/master/README.md


# Static Analisys Tools
###############################################################################
choco install exeinfo
choco install die
choco install explorersuite
choco install dependencywalker
choco install pestudio
choco install reshack

# Dynamic Analysis Tools
###############################################################################
choco install regshot
#http://www.rohitab.com/download/api-monitor-v2r13-setup-x64.exe
#https://downloads.novirusthanks.org/files/pe_capture_setup.exe
choco install x64dbg.portable
#https://debugger.immunityinc.com/ID_register.py
choco install ida-free
choco install ghidra
choco install sysinternals --params "/InstallDir:C:\Tools\sysinternals" --ignore-checksums

# Network Tools
###############################################################################
choco install fiddler

Invoke-WebRequest -Uri https://github.com/dnSpy/dnSpy/releases/latest/download/dnSpy-netframework.zip -OutFile "$env:TEMP\dnSpy-netframework.zip"
Expand-Archive -Path "$env:TEMP\dnSpy-netframework.zip" -DestinationPath "C:\Tools\dnSpy"

# IE first run
New-Item -Path "HKLM:\SOFTWARE\Policies\Microsoft\Internet Explorer"
New-Item -Path "HKLM:\SOFTWARE\Policies\Microsoft\Internet Explorer\Main"
New-ItemProperty -Path "HKLM:\SOFTWARE\Policies\Microsoft\Internet Explorer\Main" -Name DisableFirstRunCustomize -Value 1

# GPRegistryPolicy
Install-Module GPRegistryPolicy -Force

# UI
Import-Module "$env:ChocolateyInstall\helpers\chocolateyInstaller.psm1" -Force
Set-WindowsExplorerOptions -EnableShowFileExtensions -EnableShowFullPathInTitleBar -EnableExpandToOpenFolder -EnableShowRibbon

New-Item -Path C:\ -Name BGInfo -ItemType Directory -ErrorAction SilentlyContinue
Invoke-WebRequest -Uri 'https://github.com/mostwantedduck/setup-machines/raw/main/wallpaper-win10.jpg' -OutFile "C:\BGInfo\wallpaper.jpg"
Invoke-WebRequest -Uri 'https://github.com/mostwantedduck/setup-machines/raw/main/bginfo.bgi' -OutFile "C:\BGInfo\bginfo.bgi"
New-ItemProperty -Path HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Run\ -Name BGInfo -Value "C:\tools\sysinternals\Bginfo64.exe /accepteula /iC:\BGInfo\bginfo.bgi /timer:0"

# Misc
$DesktopPath = [Environment]::GetFolderPath("Desktop")
Remove-Item -Path "C:\Users\Public\Desktop\Boxstarter Shell.lnk"
Remove-Item -Path "C:\Users\Public\Desktop\Microsoft Edge.lnk"
Remove-Item -Path C:\Temp\ -Recurse -Force
